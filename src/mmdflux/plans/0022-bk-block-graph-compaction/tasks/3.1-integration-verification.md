# Task 3.1: Integration Verification and Fixture Updates

## Objective

Verify the block graph compaction produces correct results across all test fixtures. Update any snapshot assertions. Visually confirm stagger improvement on affected diagrams.

## Location

Modify: `tests/integration.rs` (if snapshot assertions need updating), `src/dagre/bk.rs` (if any unit test coordinates need updating)

## TDD Phases

### ðŸ”´ Red: Run All Tests

```bash
cargo test
cargo test --test integration
cargo clippy
cargo fmt --check
```

Identify any failures. Expected:
- Some BK unit tests may fail due to changed coordinate values
- Integration tests may fail if they assert exact rendered output

### ðŸŸ¢ Green: Fix Failures

For each failing test:
1. **BK unit tests**: Update expected coordinate values. Verify the new values satisfy separation constraints (the invariant that matters).
2. **Integration tests**: Re-render affected fixtures and update expected output. Verify the new output is correct (stagger should be visible).

### ðŸ”µ Refactor: Visual Verification

Run these fixtures and visually verify improvement:

```bash
cargo run -q -- tests/fixtures/double_skip.mmd
cargo run -q -- tests/fixtures/skip_edge_collision.mmd
cargo run -q -- tests/fixtures/stacked_fan_in.mmd
```

For `double_skip.mmd`, skip edges Aâ†’C and Aâ†’D should now route through open diagonal space rather than tight against Step 1 and Step 2 borders.

Also verify no regressions on other fixtures:
```bash
for f in tests/fixtures/*.mmd; do echo "=== $f ==="; cargo run -q -- "$f"; echo; done
```

## Context

This phase ensures the algorithmic change produces correct, improved output across the full test suite. The primary success criterion is visual: skip edges should have more space around intermediate nodes.

## Acceptance Criteria

- [ ] `cargo test` passes (all unit and integration tests)
- [ ] `cargo clippy` clean
- [ ] `cargo fmt --check` clean
- [ ] `double_skip.mmd` shows improved stagger
- [ ] `skip_edge_collision.mmd` shows improved routing
- [ ] No visible regressions in other fixtures
- [ ] Phase commit created
