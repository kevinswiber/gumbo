# Task 6.2: Handle Edge Routing with Label Waypoints

## Objective
Verify that edges with label dummies produce correct waypoints and that the edge router handles these waypoints properly.

## Location
Tests in: `src/render/router.rs` or integration tests
Possibly modify: `src/render/router.rs`

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_labeled_edge_has_waypoint_at_label() {
    let input = r#"graph TD
    A -->|yes| B"#;
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let layout = compute_layout(&diagram, &RenderConfig::default());

    // The A->B edge should have at least one waypoint (from the label dummy)
    let edge = &diagram.edges[0];
    let waypoints = &layout.edge_waypoints[0]; // or however waypoints are indexed
    assert!(!waypoints.is_empty(),
        "Labeled edge should have waypoints from label dummy");
}

#[test]
fn test_labeled_edge_routes_through_waypoint() {
    // Verify the routed path passes through the label waypoint
    let input = r#"graph TD
    A -->|yes| B"#;
    let output = render_to_string(input);

    // The edge should have a visible vertical segment above and below the label
    // (not just a direct connection)
    let lines: Vec<&str> = output.lines().collect();
    let edge_chars: Vec<_> = lines.iter()
        .enumerate()
        .filter(|(_, l)| l.contains('â”‚') || l.contains('â–¼'))
        .collect();
    assert!(edge_chars.len() >= 2, "Edge should have segments above and below label");
}
```

**What the failing test asserts:** Labeled edges produce waypoints from their label dummy nodes, and the edge router uses these waypoints.
**Expected failure reason:** Formerly-short edges (A->B with 1 rank) now have a dummy chain, producing waypoints. The router may not handle this case if it was optimized for direct (waypoint-free) short edges.

### ðŸŸ¢ Green: Minimal Implementation

If `route_edge()` already handles edges with waypoints correctly (it does for long edges), this may pass. If not, ensure the routing logic doesn't skip waypoints for edges that are "adjacent in the original graph."

### ðŸ”µ Refactor: Clean Up

N/A if verification-only.

## Context
- Edge routing in `src/render/router.rs` has `route_edge_with_waypoints()` for edges with dagre waypoints
- Previously, A->B (1-rank span) had no waypoints and used `route_edge_direct()`
- Now A->B has 1 waypoint from the label dummy chain
- The routing code should route through this waypoint, creating an edge path that has room for the label

## Acceptance Criteria
- [ ] Labeled edges produce waypoints from label dummies
- [ ] Edge router correctly handles these waypoints
- [ ] Edge path has segments above and below the label position
