# Task 1.2: Add Style/Class Statement Passthrough

## Objective

Parse and silently discard `style`, `classDef`, `class`, `click`, and `linkStyle` statements so that diagrams containing CSS styling don't produce parse errors. mmdflux renders to text, so visual styles are irrelevant, but they must not break parsing.

## Location

Modify: `src/parser/grammar.pest`
Modify: `src/parser/flowchart.rs` (parse tree walker â€” skip style rules)

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_style_statement_ignored() {
    let input = "graph TD\nA --> B\nstyle A fill:#f9f,stroke:#333\n";
    let result = parse_flowchart(input).unwrap();
    assert_eq!(result.edges().len(), 1);
}

#[test]
fn test_classdef_statement_ignored() {
    let input = "graph TD\nA --> B\nclassDef warning fill:#ff0\nclass A warning\n";
    let result = parse_flowchart(input).unwrap();
    assert_eq!(result.edges().len(), 1);
}

#[test]
fn test_click_statement_ignored() {
    let input = "graph TD\nA --> B\nclick A callback\n";
    let result = parse_flowchart(input).unwrap();
    assert_eq!(result.edges().len(), 1);
}

#[test]
fn test_linkstyle_statement_ignored() {
    let input = "graph TD\nA --> B\nlinkStyle 0 stroke:#ff3,stroke-width:4px\n";
    let result = parse_flowchart(input).unwrap();
    assert_eq!(result.edges().len(), 1);
}
```

**What the failing test asserts:** Diagrams with style statements parse successfully, producing the correct edges while ignoring style lines.
**Expected failure reason:** The grammar doesn't recognize `style`, `classDef`, `class`, `click`, or `linkStyle` keywords, so these lines cause parse errors.

### Green: Minimal Implementation

Add grammar rules that consume style statements without capturing them:

```pest
style_stmt = _{ ^"style" ~ (!NEWLINE_CHAR ~ ANY)* }
classdef_stmt = _{ ^"classDef" ~ (!NEWLINE_CHAR ~ ANY)* }
class_stmt = _{ ^"class" ~ (!NEWLINE_CHAR ~ ANY)* }
click_stmt = _{ ^"click" ~ (!NEWLINE_CHAR ~ ANY)* }
linkstyle_stmt = _{ ^"linkStyle" ~ (!NEWLINE_CHAR ~ ANY)* }
```

Using `_{ }` (silent rules) means these don't appear in the parse tree at all. Add them to the `statement` rule before `vertex_statement` so they're tried first (since node IDs like `style` could conflict).

**Important:** The `class` keyword must be matched carefully to avoid conflicting with node IDs that start with "class" (e.g., `classA`). Use word boundary detection or require whitespace after the keyword.

### Refactor: Clean Up

- Verify that node IDs like `styleA`, `classA`, `clickHandler` still parse as nodes
- Consider adding `direction` statement passthrough too (for subgraph-local direction)

## Context

Many real-world Mermaid diagrams include CSS styling. Users copying diagrams from documentation or live editors expect them to parse. The upstream Jison grammar: `src/diagrams/flowchart/parser/flow.jison` defines these statements.

See [research synthesis](../../../research/0026-mermaid-grammar-reference/synthesis.md) for grammar source details.

## Acceptance Criteria

- [ ] Failing test written and confirmed red
- [ ] Minimal implementation passes the test
- [ ] Code refactored with tests still green
- [ ] Node IDs starting with style keywords still parse correctly
- [ ] All existing tests unaffected
