# Task 4.1: Info Pest Grammar and Parser

## Objective

Implement the simplest possible Mermaid diagram type — `info` — to validate the multi-grammar workflow end to end. The info diagram just displays `"info"` with an optional `showInfo` flag and title.

## Location

Create: `src/parser/info_grammar.pest`
Create: `src/parser/info.rs`
Modify: `src/parser/mod.rs` (add `pub mod info;`)
Modify: CLI dispatch (wire info parser)

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_parse_info_minimal() {
    let result = parse_info("info\n").unwrap();
    assert!(!result.show_info);
    assert!(result.title.is_none());
}

#[test]
fn test_parse_info_show_info() {
    let result = parse_info("info\nshowInfo\n").unwrap();
    assert!(result.show_info);
}

#[test]
fn test_parse_info_with_title() {
    let result = parse_info("info\ntitle My Info\n").unwrap();
    assert_eq!(result.title.as_deref(), Some("My Info"));
}

#[test]
fn test_parse_info_invalid() {
    let result = parse_info("not info\n");
    assert!(result.is_err());
}
```

**What the failing tests assert:** The info parser correctly handles all valid info diagram inputs.
**Expected failure reason:** `parse_info` doesn't exist yet.

### Green: Minimal Implementation

**`info_grammar.pest`:**
```pest
WHITESPACE = _{ " " | "\t" }
NEWLINE_CHAR = _{ "\r"? ~ "\n" }
comment = _{ "%%" ~ (!NEWLINE_CHAR ~ ANY)* }

info_keyword = { ^"info" }
show_info = { ^"showInfo" }
title_keyword = _{ "title" }
title_text = @{ (!NEWLINE_CHAR ~ ANY)+ }
title_stmt = { title_keyword ~ title_text }

info = {
    SOI ~ NEWLINE_CHAR* ~
    info_keyword ~ NEWLINE_CHAR* ~
    (show_info ~ NEWLINE_CHAR*)? ~
    (title_stmt ~ NEWLINE_CHAR*)? ~
    EOI
}
```

**`info.rs`:**
```rust
use pest::Parser;
use pest_derive::Parser;

#[derive(Parser)]
#[grammar = "parser/info_grammar.pest"]
pub struct InfoParser;

#[derive(Debug, Clone)]
pub struct Info {
    pub show_info: bool,
    pub title: Option<String>,
}

pub fn parse_info(input: &str) -> Result<Info, ParseError> {
    let pairs = InfoParser::parse(Rule::info, input)?;
    // Walk pairs to extract show_info and title
    ...
}
```

### Refactor: Clean Up

- Ensure error messages reference "info diagram" not generic parse error
- Wire into CLI dispatch (update Task 3.2's placeholder to call `parse_info`)

## Context

Upstream Langium grammar: `~/src/mermaid/packages/parser/src/language/info/info.langium` (9 lines).

This is intentionally the simplest diagram to validate that the multi-grammar architecture works before tackling pie and packet.

## Acceptance Criteria

- [ ] Failing tests written and confirmed red
- [ ] Grammar file created and compiles
- [ ] Parser function handles all valid inputs
- [ ] Wired into CLI dispatch
- [ ] All existing tests unaffected
