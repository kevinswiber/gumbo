# Task 4.1: Test Edge-Border Crossing Produces Proper Junctions

## Objective
Write failing tests that verify edges crossing subgraph borders produce proper junction characters (e.g., `â”¼`) instead of overwriting border characters.

## Location
Modify: `/Users/kevin/src/mmdflux-subgraphs/src/render/canvas.rs` (add tests)
Also: `/Users/kevin/src/mmdflux-subgraphs/src/render/chars.rs` (add tests for `infer_connections`)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
// In chars.rs tests:
#[test]
fn test_infer_connections_horizontal() {
    let charset = CharSet::unicode();
    let conns = charset.infer_connections('â”€');
    assert!(conns.left && conns.right);
    assert!(!conns.up && !conns.down);
}

#[test]
fn test_infer_connections_vertical() {
    let charset = CharSet::unicode();
    let conns = charset.infer_connections('â”‚');
    assert!(conns.up && conns.down);
    assert!(!conns.left && !conns.right);
}

#[test]
fn test_infer_connections_corners() {
    let charset = CharSet::unicode();
    let conns = charset.infer_connections('â”Œ');
    assert!(conns.down && conns.right);
    assert!(!conns.up && !conns.left);
    // ... test all corners
}

// In canvas.rs tests:
#[test]
fn test_edge_over_border_produces_junction() {
    let charset = CharSet::unicode();
    let mut canvas = Canvas::new(10, 5);

    // Draw a horizontal border
    canvas.set_subgraph_border(0, 2, 'â”€');
    canvas.set_subgraph_border(1, 2, 'â”€');
    canvas.set_subgraph_border(2, 2, 'â”€');
    canvas.set_subgraph_border(3, 2, 'â”€');

    // Draw a vertical edge crossing the border at x=2
    canvas.set_with_connection(2, 1, 'â”‚', Connections::up_down(), &charset);
    canvas.set_with_connection(2, 2, 'â”‚', Connections::up_down(), &charset);
    canvas.set_with_connection(2, 3, 'â”‚', Connections::up_down(), &charset);

    // At the crossing point (2, 2), should be a junction â”¼ (or â”¤/â”œ/etc)
    let cell = canvas.get(2, 2);
    assert_eq!(cell.ch, 'â”¼',
        "Edge crossing border should produce junction, got: {}", cell.ch);
}
```

**What the failing tests assert:** Edge-border crossings produce proper junction characters by merging connections from both the border and the edge.
**Expected failure reason:** `set_with_connection()` doesn't infer connections from existing border characters, so the edge just overwrites with `â”‚`.

### ðŸŸ¢ Green: Minimal Implementation

*(Implementation is in Task 4.2.)*

### ðŸ”µ Refactor: Clean Up

After Task 4.2, add tests for all corner combinations and ASCII charset.

## Context
- `set_with_connection()` in `canvas.rs` (line 151) allows overwriting non-node cells
- It only checks `is_node` for protection, not `is_subgraph_border`
- The issue is that border character connections are not inferred before merging
- See [Q3: Overlap inventory](../../../research/0019-subgraph-padding-overlap/q3-overlap-inventory.md) Issues 4, 9

## Acceptance Criteria
- [ ] `infer_connections()` tests for all box-drawing characters
- [ ] Edge-over-border junction test written
- [ ] All tests confirmed red
