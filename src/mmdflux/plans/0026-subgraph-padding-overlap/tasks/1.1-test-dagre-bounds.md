# Task 1.1: Test Dagre Bounds Produce Correct Spacing

## Objective
Write failing tests that verify subgraph bounds are derived from dagre's compound positioning, not hardcoded padding. These tests define the expected behavior: subgraph borders should not overlap.

## Location
Modify: `/Users/kevin/src/mmdflux-subgraphs/src/render/layout.rs` (add tests at bottom of file)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

Write these tests first:

```rust
#[test]
fn test_subgraph_bounds_no_overlap() {
    // Parse subgraph_edges.mmd (two subgraphs with cross-edges)
    let input = std::fs::read_to_string("tests/fixtures/subgraph_edges.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout(&diagram, &config);

    // Find bounds for both subgraphs
    let bounds: Vec<_> = layout.subgraph_bounds.values().collect();
    assert!(bounds.len() >= 2, "Expected at least 2 subgraph bounds");

    // Assert no pair of bounds overlaps
    for i in 0..bounds.len() {
        for j in (i+1)..bounds.len() {
            let a = bounds[i];
            let b = bounds[j];
            let no_x_overlap = a.x + a.width <= b.x || b.x + b.width <= a.x;
            let no_y_overlap = a.y + a.height <= b.y || b.y + b.height <= a.y;
            assert!(
                no_x_overlap || no_y_overlap,
                "Subgraph bounds overlap: ({},{} {}x{}) vs ({},{} {}x{})",
                a.x, a.y, a.width, a.height,
                b.x, b.y, b.width, b.height
            );
        }
    }
}

#[test]
fn test_convert_subgraph_bounds_uses_dagre_rect() {
    // Verify that convert_subgraph_bounds uses the dagre Rect
    // when available, not just member-node positions.
    // Construct a scenario where dagre bounds are wider than
    // member-node extent + hardcoded padding, and verify the
    // result matches the dagre bounds (not the member-node computation).
    //
    // This requires constructing mock inputs to convert_subgraph_bounds()
    // with a dagre Rect that is intentionally larger than what the
    // member-node fallback would produce.
    // Details depend on the function signature after modification.
}
```

**What the failing test asserts:** Subgraph bounds from two separate subgraphs must not spatially overlap.
**Expected failure reason:** `convert_subgraph_bounds()` ignores dagre bounds and recomputes from member nodes with hardcoded padding, which can produce overlapping bounds when dagre places subgraphs close together.

### ðŸŸ¢ Green: Minimal Implementation

*(This task is test-only. Implementation is in Task 1.2.)*

### ðŸ”µ Refactor: Clean Up

After Task 1.2 makes these pass, review test clarity and add comments explaining the overlap detection logic.

## Context
- `convert_subgraph_bounds()` is at lines 696-749 of `src/render/layout.rs`
- The `_dagre_bounds` parameter is a `HashMap<String, Rect>` from `dagre::border::remove_nodes()`
- The `Rect` struct has center-based coordinates (`x`, `y` = center; `width`, `height` = full span)
- See [Q1: Bounds calculation](../../../research/0019-subgraph-padding-overlap/q1-bounds-calculation.md) for detailed analysis

## Acceptance Criteria
- [ ] Failing test written that asserts two subgraph bounds do not overlap
- [ ] Test confirmed red (fails with current implementation)
- [ ] Unit test for dagre Rect â†’ draw-coordinate transformation planned
