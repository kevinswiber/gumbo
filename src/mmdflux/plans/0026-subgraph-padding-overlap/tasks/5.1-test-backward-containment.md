# Task 5.1: Test Backward Edge Stays Within Subgraph Border

## Objective
Write a failing test that verifies backward edges inside a subgraph do not extend beyond the subgraph border.

## Location
New fixture: `/Users/kevin/src/mmdflux-subgraphs/tests/fixtures/backward_in_subgraph.mmd`
Modify: `/Users/kevin/src/mmdflux-subgraphs/tests/integration.rs` (add test)

## TDD Phases

### ğŸ”´ Red: Write Failing Tests

Create fixture `backward_in_subgraph.mmd`:
```
graph TD
subgraph sg1[Group]
A[Node] --> B[Node2]
B --> A
end
```

Add integration test:
```rust
#[test]
fn test_backward_edge_within_subgraph() {
    let input = std::fs::read_to_string("tests/fixtures/backward_in_subgraph.mmd").unwrap();
    let output = render_to_string(&input);
    let lines: Vec<&str> = output.lines().collect();

    // Find the subgraph border's rightmost column
    // (look for â” or â”˜ characters, or the rightmost â”‚ on border rows)
    let mut border_right = 0;
    for line in &lines {
        for (col, ch) in line.chars().enumerate() {
            if ch == 'â”' || ch == 'â”˜' {
                border_right = border_right.max(col);
            }
        }
    }

    // No edge characters should appear to the right of the border
    for (row, line) in lines.iter().enumerate() {
        for (col, ch) in line.chars().enumerate() {
            if col > border_right && (ch == 'â”‚' || ch == 'â”€' || ch == 'â”' || ch == 'â”˜'
                || ch == 'â—„' || ch == 'â–º' || ch == 'â–²' || ch == 'â–¼') {
                panic!("Edge character '{}' at ({}, {}) is outside border (right={})\nOutput:\n{}",
                    ch, col, row, border_right, output);
            }
        }
    }
}
```

**What the failing test asserts:** All edge characters (including backward edge routing) stay within the subgraph border bounds.
**Expected failure reason:** Backward edges route to the right of nodes, extending past the subgraph border.

### ğŸŸ¢ Green: Minimal Implementation

*(Implementation is in Task 5.2.)*

### ğŸ”µ Refactor: Clean Up

Verify with LR/RL layouts too if applicable.

## Context
- Backward edges use synthetic routing that goes right (in TD) or down (in LR) of nodes
- The router has no concept of subgraph boundaries
- See [Q3: Overlap inventory](../../../research/0019-subgraph-padding-overlap/q3-overlap-inventory.md) Issue 7

## Acceptance Criteria
- [ ] Test fixture created
- [ ] Integration test verifies no edge characters outside border
- [ ] Test confirmed red (backward edge escapes border)
