# Task 2.2: Implement Embedded Title Rendering

## Objective
Replace the floating title (above the border) with an embedded title in the top border line: `â”Œâ”€ Title â”€â”`.

## Location
Modify: `/Users/kevin/src/mmdflux-subgraphs/src/render/subgraph.rs` â€” `render_subgraph_borders()`

## TDD Phases

### ğŸ”´ Red: Write Failing Tests

Tests from Task 2.1 should already be failing.

### ğŸŸ¢ Green: Minimal Implementation

In `render_subgraph_borders()`:

1. **Remove the floating title block** (current lines 26-30):
   ```rust
   // DELETE:
   // if y > 0 {
   //     for (i, ch) in bounds.title.chars().enumerate() {
   //         canvas.set(x + i, y - 1, ch);
   //     }
   // }
   ```

2. **Replace the top-edge rendering** with embedded title logic:
   ```rust
   // Top edge with embedded title
   canvas.set_subgraph_border(x, y, charset.corner_tl);
   canvas.set_subgraph_border(x + w - 1, y, charset.corner_tr);

   let inner_width = w.saturating_sub(2); // space between corners
   if !bounds.title.is_empty() && inner_width >= 5 {
       // Format: â”Œâ”€ Title â”€â”
       // Prefix: "â”€ " (2 chars), Suffix: " â”€" (2 chars) = 4 overhead
       canvas.set_subgraph_border(x + 1, y, charset.horizontal);
       canvas.set_subgraph_border(x + 2, y, ' ');

       let max_title_len = inner_width.saturating_sub(4);
       let title: String = bounds.title.chars().take(max_title_len).collect();
       for (i, ch) in title.chars().enumerate() {
           canvas.set_subgraph_border(x + 3 + i, y, ch);
       }
       let title_end = x + 3 + title.len();
       canvas.set_subgraph_border(title_end, y, ' ');

       // Fill remaining with horizontal lines
       for dx in (title_end + 1)..(x + w - 1) {
           canvas.set_subgraph_border(dx, y, charset.horizontal);
       }
   } else {
       // No title or too narrow: plain horizontal
       for dx in 1..(w - 1) {
           canvas.set_subgraph_border(x + dx, y, charset.horizontal);
       }
   }
   ```

3. **Keep the rest of the border rendering** (sides and bottom) unchanged.

### ğŸ”µ Refactor: Clean Up

- Extract the top-edge rendering into a helper if it's getting long
- Ensure ASCII charset also works (test with `CharSet::ascii()`)
- Verify that existing subgraph tests are updated or marked for Phase 3

## Context
- The current floating title uses `canvas.set()` (unprotected writes)
- The embedded title uses `canvas.set_subgraph_border()` (marks cells as border)
- The `charset.horizontal` character is `â”€` (unicode) or `-` (ascii)
- See [Q2: Title rendering](../../../research/0019-subgraph-padding-overlap/q2-title-rendering.md) for full analysis

## Acceptance Criteria
- [ ] Floating title removed
- [ ] Embedded title rendered in top border line
- [ ] Title truncated when border is too narrow
- [ ] Title renders correctly at y=0 (no y>0 guard)
- [ ] Task 2.1 tests pass
