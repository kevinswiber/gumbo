# Task 1.1: Global minlen doubling in `make_space_for_edge_labels()`

## Objective

Change `make_space_for_edge_labels()` to double ALL edge minlens when any edge has a label, matching dagre.js's global transformation. This creates a uniform rank grid where all rank differences are even â€” an invariant that downstream Sugiyama phases depend on.

## Location

Modify: `src/dagre/mod.rs` (lines 50-59)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_make_space_doubles_all_minlens() {
    let mut graph: DiGraph<(f64, f64)> = DiGraph::new();
    graph.add_node("A", (5.0, 3.0));
    graph.add_node("B", (5.0, 3.0));
    graph.add_node("C", (5.0, 3.0));
    graph.add_edge("A", "B"); // edge 0: labeled
    graph.add_edge("B", "C"); // edge 1: unlabeled

    let mut lg = LayoutGraph::from_digraph(&graph, |_, dims| *dims);

    let mut edge_labels = HashMap::new();
    edge_labels.insert(0, normalize::EdgeLabelInfo::new(5.0, 1.0));

    make_space_for_edge_labels(&mut lg, &edge_labels);

    // ALL edges should be doubled, not just the labeled one
    assert_eq!(lg.edge_minlens[0], 2); // labeled edge: 1 * 2 = 2
    assert_eq!(lg.edge_minlens[1], 2); // unlabeled edge: 1 * 2 = 2
}

#[test]
fn test_make_space_noop_when_no_labels() {
    let mut graph: DiGraph<(f64, f64)> = DiGraph::new();
    graph.add_node("A", (5.0, 3.0));
    graph.add_node("B", (5.0, 3.0));
    graph.add_edge("A", "B");

    let mut lg = LayoutGraph::from_digraph(&graph, |_, dims| *dims);
    let edge_labels = HashMap::new(); // empty

    make_space_for_edge_labels(&mut lg, &edge_labels);

    assert_eq!(lg.edge_minlens[0], 1); // unchanged
}
```

**What the failing test asserts:** When any edge has a label, ALL edges get their minlen doubled (not just labeled ones).
**Expected failure reason:** Current implementation only sets minlen=2 for edges present in `edge_labels` keys, leaving unlabeled edges at minlen=1.

### ðŸŸ¢ Green: Minimal Implementation

```rust
fn make_space_for_edge_labels(
    lg: &mut LayoutGraph,
    edge_labels: &HashMap<usize, normalize::EdgeLabelInfo>,
) {
    if edge_labels.is_empty() {
        return;
    }
    for minlen in &mut lg.edge_minlens {
        *minlen *= 2;
    }
}
```

### ðŸ”µ Refactor: Clean Up

- Update the existing test `test_make_space_sets_minlen_for_labeled_edges` to expect minlen=2 for BOTH edges (or replace it with the new tests)
- Remove the bounds check `if edge_idx < lg.edge_minlens.len()` since we iterate the vec directly

## Context

- `edge_minlens` is a `Vec<i32>` initialized to all 1s in `LayoutGraph::from_digraph()`
- The ranker at `rank.rs:53` already uses `graph.edge_minlens[edge_idx]` per edge
- Reversed edges start with minlen=1 like all others, so doubling gives minlen=2

## Acceptance Criteria

- [ ] Failing tests written and confirmed red
- [ ] All edge minlens doubled when any label present
- [ ] No-op when edge_labels is empty
- [ ] Existing test updated to match new behavior
- [ ] `cargo test` passes
