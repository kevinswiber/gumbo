# Task 3.2: Verify backward edge routing on cycle fixtures

## Objective

Verify that backward edges in cycle-containing fixtures route compactly after stripping dagre waypoints.

## Location

Modify: `tests/integration.rs`

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn simple_cycle_compact_backward_routing() {
    let input = std::fs::read_to_string("tests/fixtures/simple_cycle.mmd").unwrap();
    let flowchart = mmdflux::parser::parse_flowchart(&input).unwrap();
    let diagram = mmdflux::graph::build_diagram(&flowchart);
    let output = mmdflux::render::render(&diagram, &Default::default());

    // Backward edge should not create a tall vertical column
    let line_count = output.lines().count();
    assert!(
        line_count < 30,
        "simple_cycle.mmd should be compact, got {line_count} lines"
    );
}

#[test]
fn multiple_cycles_compact_backward_routing() {
    let input = std::fs::read_to_string("tests/fixtures/multiple_cycles.mmd").unwrap();
    let flowchart = mmdflux::parser::parse_flowchart(&input).unwrap();
    let diagram = mmdflux::graph::build_diagram(&flowchart);
    let output = mmdflux::render::render(&diagram, &Default::default());

    let line_count = output.lines().count();
    assert!(
        line_count < 40,
        "multiple_cycles.mmd should be compact, got {line_count} lines"
    );
}
```

**What the failing test asserts:** Cycle fixtures produce compact output.
**Expected failure reason:** Before task 3.1, backward edges with dagre waypoints inflate the layout.

### ðŸŸ¢ Green: Minimal Implementation

Should pass after task 3.1 is complete.

### ðŸ”µ Refactor: Clean Up

Adjust height thresholds based on actual output after all Phase 1-3 changes.

## Context

- `simple_cycle.mmd` and `multiple_cycles.mmd` are existing test fixtures
- These may not have labels, so the global minlen doubling may not activate â€” in that case, backward edges won't have dagre waypoints anyway
- The real regression test is `labeled_edges.mmd` (tested in 1.3) which has a labeled backward edge

## Acceptance Criteria

- [ ] Tests written for cycle fixtures
- [ ] Backward edges route compactly in all cycle fixtures
- [ ] `cargo test` passes
