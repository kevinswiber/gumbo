# Task 2.2: Sort Edges Within Face Groups

## Objective
When multiple edges attach to the same face, determine their left-to-right (or top-to-bottom) ordering to minimize visual crossings.

## Location
Modify: `src/render/router.rs` (within or alongside `compute_attachment_plan()`)

## Implementation

```rust
/// Sorts a face group so that edge attachment points are assigned in an order
/// that minimizes crossings. The sort key is the cross-axis position of the
/// "other end" of each edge.
///
/// For Top/Bottom faces (horizontal): sort by x-position of the other node
/// For Left/Right faces (vertical): sort by y-position of the other node
fn sort_face_group(
    group: &mut Vec<(usize, bool)>,  // (edge_index, is_source_side)
    edges: &[Edge],
    layout: &Layout,
    face: NodeFace,
) {
    group.sort_by_key(|&(edge_i, is_source)| {
        let edge = &edges[edge_i];
        // The "other" node is the one NOT on this face
        let other_id = if is_source { &edge.to } else { &edge.from };
        let other_bounds = layout.node_bounds.get(other_id);

        match face {
            NodeFace::Top | NodeFace::Bottom => {
                // Horizontal face: sort by x-position of the other end
                other_bounds.map(|b| b.center_x()).unwrap_or(0)
            }
            NodeFace::Left | NodeFace::Right => {
                // Vertical face: sort by y-position of the other end
                other_bounds.map(|b| b.center_y()).unwrap_or(0)
            }
        }
    });
}
```

## Context
- This ensures that when node A has three incoming edges from B (left), C (center), D (right) on its top face, they attach in left-to-right order matching B, C, D's positions â€” preventing crossings.
- For the `ci_pipeline.mmd` case: the Deploy diamond's right face has edges to Staging (above) and Production (below). Sorting by y-position of the other node places Staging's attachment point above Production's.
- For `multiple_cycles.mmd`: node A's bottom face has forward edge to B and (potentially) backward edges. Sorting by the other endpoint's x-position gives a stable order.

## Acceptance Criteria
- [ ] Horizontal faces sort by x-coordinate of other endpoint
- [ ] Vertical faces sort by y-coordinate of other endpoint
- [ ] Handles missing node bounds gracefully (defaults to 0)
- [ ] Produces consistent, deterministic ordering
