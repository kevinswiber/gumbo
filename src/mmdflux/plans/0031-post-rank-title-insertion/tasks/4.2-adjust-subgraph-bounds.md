# Task 4.2: Adjust `convert_subgraph_bounds()` for Title Space

## Objective

Extend the top boundary of titled subgraphs in `convert_subgraph_bounds()` to account for the title row. The dagre layout now reserves a rank for the title, but the render layer's bounds computation may need extra padding for the title text embedded in the border.

## Location

Modify: `src/render/layout.rs` â€” `convert_subgraph_bounds()` function

## TDD Phases

### Red: Write Failing Test

```rust
#[test]
fn test_subgraph_bounds_title_extends_top() {
    // Titled subgraph should have more top space than untitled
    let titled_input = r#"graph TD
    subgraph sg1[Processing]
        A[Step 1] --> B[Step 2]
    end"#;
    let untitled_input = r#"graph TD
    subgraph sg1
        A[Step 1] --> B[Step 2]
    end"#;

    let titled_fc = parse_flowchart(titled_input).unwrap();
    let titled_diagram = build_diagram(&titled_fc);
    let untitled_fc = parse_flowchart(untitled_input).unwrap();
    let untitled_diagram = build_diagram(&untitled_fc);

    let config = RenderConfig::default();
    let titled_layout = compute_layout(&titled_diagram, &config);
    let untitled_layout = compute_layout(&untitled_diagram, &config);

    let titled_bounds = &titled_layout.subgraph_bounds["sg1"];
    let untitled_bounds = &untitled_layout.subgraph_bounds["sg1"];

    // Titled subgraph should have a lower y (higher on screen) than untitled,
    // because the title takes extra space above
    assert!(
        titled_bounds.y < untitled_bounds.y,
        "Titled bounds y={} should be above untitled y={}",
        titled_bounds.y, untitled_bounds.y
    );
}
```

**Expected failure reason:** `convert_subgraph_bounds()` doesn't yet account for title space, so both bounds have the same top padding.

Note: This test may need adjustment based on the actual coordinate system (draw coordinates vs dagre coordinates). The key assertion is that the titled subgraph has more space above the first content node.

### Green: Minimal Implementation

In `convert_subgraph_bounds()`, add extra top padding for titled subgraphs:

```rust
// After computing min_y from member node positions:
let title_extra: usize = if !sg.title.is_empty() { 2 } else { 0 };
let border_y = min_y.saturating_sub(border_padding + title_extra);
```

The `title_extra = 2` provides:
- 1 row for the title text (embedded in the top border)
- 1 row for spacing between title and first content node

The exact value may need tuning based on visual output. The dagre title rank already provides structural separation; this extra padding ensures the render-layer border encompasses the title rank's visual space.

### Refactor: Clean Up

- If `title_extra` depends on the subgraph's title text or spacing config, extract it to a constant or make it configurable.
- Consider whether `title_extra` should be applied to all four directions (LR, RL, BT) or only the primary axis. For now, TD/BT affect Y and LR/RL affect X.

## Context

`convert_subgraph_bounds()` computes draw-coordinate bounds from member node positions with a fixed `border_padding = 2` on all sides. The function has access to the subgraph's title via the `diagram.subgraphs` map.

The title text is rendered by `render_subgraph_borders()` in `subgraph.rs`, which embeds the title in the top border line at `bounds.y`. The extra padding ensures the border extends high enough to contain the title row above the first content node.

## Acceptance Criteria

- [ ] Failing test written and confirmed red
- [ ] `convert_subgraph_bounds()` adds extra top padding for titled subgraphs
- [ ] Titled subgraph has more top space than untitled
- [ ] Untitled subgraph bounds unchanged
- [ ] All existing tests still pass
