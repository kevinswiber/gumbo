# Task 2.2: Use dagre bounds as primary source in `convert_subgraph_bounds()`

## Objective
Modify `convert_subgraph_bounds()` to use dagre bounds (transformed via `to_ascii_rect()`) as the primary source, keeping member-node computation as fallback.

## Location
Modify: `src/render/layout.rs` â€” `convert_subgraph_bounds()` function (~lines 700-812)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

Task 2.1's test should already be failing. This task makes it pass.

### ðŸŸ¢ Green: Minimal Implementation

Modify `convert_subgraph_bounds()`:

1. Rename `_dagre_bounds` â†’ `dagre_bounds`, `_ctx` â†’ `ctx`
2. For each subgraph, try dagre bounds first:

```rust
let (border_x, border_y, border_w, border_h) = if let Some(dagre_rect) = dagre_bounds.get(&sg.id) {
    let (x, y, w, h) = ctx.to_ascii_rect(dagre_rect);
    (x, y, x + w, y + h)  // convert to (x, y, right, bottom)
} else {
    // Existing member-node fallback
    let mut min_x = usize::MAX;
    // ... existing code ...
    (border_x, border_y, border_right, border_bottom)
};
```

3. Continue with existing title-width minimum enforcement
4. Continue with existing backward edge expansion
5. Build `SubgraphBounds` from the result

### ðŸ”µ Refactor: Clean Up

- Remove underscore prefixes from all now-used parameters
- Update function doc comment to describe primary/fallback strategy
- Consider whether `border_padding` should be applied differently for dagre bounds vs member-node bounds

## Context

The key insight is that dagre bounds are center-based Rects in dagre float space. `to_ascii_rect()` (from Task 1.1) transforms them to draw coordinates. The member-node fallback remains for cases where dagre bounds are missing.

After this change, dagre's non-overlapping guarantees propagate to draw coordinates, fixing Issue 0005.

See [Q3: mmdflux Current Behavior](../../../research/0021-subgraph-border-overlap-deep-dive/q3-mmdflux-current-behavior.md) for detailed analysis of the current implementation.

## Acceptance Criteria
- [ ] `convert_subgraph_bounds()` uses dagre bounds when available
- [ ] Falls back to member-node approach when dagre bounds are missing
- [ ] Task 2.1's non-overlap test passes
- [ ] Title-width minimum still enforced
- [ ] Backward edge expansion still applied
