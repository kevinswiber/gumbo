# Task 2.2: Populate `dagre_center` in Layout Pipelines

## Objective
Store the computed integer center coordinates in `NodeBounds` during layout computation, so they round-trip correctly through `center_x()`/`center_y()`.

## Location
Modify: `src/render/layout.rs` (functions `compute_layout_direct`, `compute_layout_dagre`, and related helpers)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_simple_mmd_no_centering_jog() {
    let input = "graph TD\n    A[Start] --> B[End]";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    // Find the edge and route it
    let edge = &layout.edges[0];
    let routed = route_edge(edge, &layout, &config);

    // The edge should be perfectly vertical (no centering jog)
    assert_eq!(routed.start.x, routed.end.x,
        "Simple TD edge should be straight vertical, no centering jog");
}
```

**What the failing test asserts:** A simple Aâ†’B edge in TD layout is perfectly vertical.
**Expected failure reason:** Integer division centering causes a 1-cell jog when nodes have different widths.

### ðŸŸ¢ Green: Minimal Implementation

In `compute_layout_direct()` (around line 347-355), when constructing `NodeBounds`:

```rust
let center_x = ((rect.x + rect.width / 2.0 - dagre_min_x) * scale_x).round() as usize;
let center_y = ((rect.y + rect.height / 2.0 - dagre_min_y) * scale_y).round() as usize;
let x = center_x.saturating_sub(w / 2) + padding;
let y = center_y.saturating_sub(h / 2) + padding;

NodeBounds {
    x, y, width: w, height: h,
    dagre_center_x: Some(center_x + padding),
    dagre_center_y: Some(center_y + padding),
}
```

Note: The `+ padding` offset must be applied to dagre_center values since `x` and `y` already include padding.

Apply the same pattern in `compute_layout_dagre()` and any other pipeline that creates `NodeBounds` from dagre coordinates.

### ðŸ”µ Refactor: Clean Up

- Verify the padding arithmetic is consistent between `x` and `dagre_center_x`
- Consider adding an assertion: `debug_assert!(bounds.dagre_center_x.unwrap() >= bounds.x)`

## Context
- The centering jog is most visible in `simple.mmd` where "Start" (width=9) and "End" (width=7) share a dagre column
- `compute_layout_direct` is at `src/render/layout.rs` around line 280+
- The `center_x` variable is already computed â€” just need to store it

## Acceptance Criteria
- [ ] Failing test passes after implementation
- [ ] `simple.mmd` renders with straight vertical edges
- [ ] `cargo test --test integration` passes
