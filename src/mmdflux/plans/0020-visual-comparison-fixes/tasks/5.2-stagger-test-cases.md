# Task 5.2: Identify Skip-Edge Stagger Test Cases

## Objective
Create test cases that verify skip edges have visual separation from nodes they pass by.

## Location
Modify: `tests/integration.rs` or `src/dagre/bk.rs` (test module)

## TDD Phases

### ğŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_double_skip_edge_stagger() {
    let input = std::fs::read_to_string("tests/fixtures/double_skip.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    // Find skip edges (A->C and A->D)
    for edge in &layout.edges {
        if edge.is_skip_edge() {
            // Get waypoints for this edge
            let waypoints = &edge.waypoints;
            // For each waypoint, check that its x-coordinate differs from
            // all non-source/non-target real node x-coordinates by at least edge_sep
            for wp in waypoints {
                for (node_id, node_bounds) in &layout.node_bounds {
                    if node_id != &edge.source_id && node_id != &edge.target_id {
                        let node_center_x = node_bounds.center_x();
                        let distance = if wp.x > node_center_x {
                            wp.x - node_center_x
                        } else {
                            node_center_x - wp.x
                        };
                        assert!(distance >= config.edge_sep,
                            "Skip edge waypoint should be separated from node {} by at least edge_sep", node_id);
                    }
                }
            }
        }
    }
}
```

**What the failing test asserts:** Skip edge waypoints maintain minimum separation from intermediate nodes.
**Expected failure reason:** Current BK compaction doesn't create separation constraints, so waypoints land on top of nodes.

### ğŸŸ¢ Green: Minimal Implementation

*(Tests should pass after Task 5.3)*

### ğŸ”µ Refactor: Clean Up

- Add similar test for `skip_edge_collision.mmd`

## Acceptance Criteria
- [ ] Tests define clear stagger requirements
- [ ] Tests fail before Phase 5 fix
- [ ] Tests pass after Phase 5 fix
