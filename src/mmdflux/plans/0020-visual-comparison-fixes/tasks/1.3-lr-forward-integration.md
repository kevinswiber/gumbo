# Task 1.3: Integration Tests for LR Forward Edge Horizontal Segments

## Objective
Verify that LR forward edges produce horizontal segments with correct arrow directions.

## Location
Modify: `src/render/router.rs` (test module) or `tests/integration.rs`

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_lr_forward_edge_produces_horizontal_segment() {
    let input = "graph LR\n    A[Start] --> B[End]";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    // Route the edge
    let edge = &layout.edges[0];
    let routed = route_edge(edge, &layout, &config);

    // Entry direction should be Left (entering target from the left side)
    assert_eq!(routed.entry_direction, AttachDirection::Left,
        "LR forward edge should enter target from the left");

    // All segments should be horizontal (no vertical segments in a same-rank LR edge)
    for seg in &routed.segments {
        assert!(matches!(seg, Segment::Horizontal { .. }),
            "LR same-rank edge should only have horizontal segments, got {:?}", seg);
    }
}

#[test]
fn test_lr_fan_in_all_horizontal() {
    // fan_in_lr.mmd: multiple sources to one target
    let input = std::fs::read_to_string("tests/fixtures/fan_in_lr.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    for edge_layout in &layout.edges {
        let routed = route_edge(edge_layout, &layout, &config);
        assert_eq!(routed.entry_direction, AttachDirection::Left,
            "All LR fan-in edges should enter from the left");
    }
}
```

**What the failing test asserts:** LR forward edges produce horizontal-only segments with `AttachDirection::Left` entry.
**Expected failure reason:** Before Phase 1 fix, vertical segments appear and entry direction is wrong.

### ðŸŸ¢ Green: Minimal Implementation

*(Tests should pass after Task 1.2 implementation)*

### ðŸ”µ Refactor: Clean Up

- Consolidate helper functions for creating test diagrams if patterns repeat

## Acceptance Criteria
- [ ] Tests pass after Phase 1 implementation
- [ ] `fan_in_lr.mmd` renders correctly
