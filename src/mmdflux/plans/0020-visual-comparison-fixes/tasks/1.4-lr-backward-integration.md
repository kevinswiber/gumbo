# Task 1.4: Integration Tests for LR Backward Edge Routing

## Objective
Verify that LR backward edges route correctly after the consensus-y fix.

## Location
Modify: `src/render/router.rs` (test module) or `tests/integration.rs`

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_lr_backward_edge_routes_without_panic() {
    // Create a diagram with a backward edge in LR layout
    let input = "graph LR\n    A[Start] --> B[Middle]\n    B --> C[End]\n    C --> A";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    // The C-->A edge is backward (goes from higher rank to lower rank)
    // Find it and route it
    for edge_layout in &layout.edges {
        if edge_layout.is_backward {
            let routed = route_backward_edge(edge_layout, &layout, &config);
            // Should not panic
            // Segments should form a valid path (no zero-length segments)
            assert!(!routed.segments.is_empty(),
                "Backward edge should have at least one segment");
        }
    }
}

#[test]
fn test_lr_backward_edge_entry_direction() {
    let input = "graph LR\n    A --> B\n    B --> A";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout_direct(&diagram, &config);

    for edge_layout in &layout.edges {
        if edge_layout.is_backward {
            let routed = route_backward_edge(edge_layout, &layout, &config);
            // LR backward edge should enter target from the right side
            assert_eq!(routed.entry_direction, AttachDirection::Right,
                "LR backward edge should enter from the right");
        }
    }
}
```

**What the failing test asserts:** LR backward edges route without panics and have correct entry direction.
**Expected failure reason:** Current backward edge routing may produce wrong entry direction or panic on consensus-y change.

### ðŸŸ¢ Green: Minimal Implementation

*(Tests should pass after Task 1.2 implementation; may need minor backward-edge adjustments)*

### ðŸ”µ Refactor: Clean Up

- Verify no regressions in existing backward edge tests

## Acceptance Criteria
- [ ] Backward edges route without panics
- [ ] Entry direction is `AttachDirection::Right` for LR backward edges
- [ ] `ci_pipeline.mmd` and `git_workflow.mmd` render correctly
