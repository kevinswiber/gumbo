# Task 1.1: Consensus-Y Unit Tests for `resolve_attachment_points`

## Objective
Write failing tests that define the expected behavior: LR/RL attachment points should share a consensus y-coordinate when both nodes are on the same rank.

## Location
Modify: `src/render/router.rs` (test module at bottom of file)

## TDD Phases

### ðŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_lr_attachment_consensus_y_same_height() {
    // Two nodes at different y positions but same height
    let from = NodeBounds { x: 0, y: 2, width: 10, height: 3, dagre_center_x: None, dagre_center_y: Some(3) };
    let to = NodeBounds { x: 20, y: 4, width: 10, height: 3, dagre_center_x: None, dagre_center_y: Some(5) };
    let (src, tgt) = resolve_attachment_points(
        &from, &to, &Direction::LeftRight, None, None,
    );
    // Both attachment points should share the same y-coordinate
    assert_eq!(src.1, tgt.1, "LR attachment points should have consensus y");
}

#[test]
fn test_lr_attachment_consensus_y_different_height() {
    // Node A height=3, Node B height=5 â€” different center_y values
    let from = NodeBounds { x: 0, y: 2, width: 10, height: 3, dagre_center_x: None, dagre_center_y: Some(3) };
    let to = NodeBounds { x: 20, y: 1, width: 10, height: 5, dagre_center_x: None, dagre_center_y: Some(3) };
    let (src, tgt) = resolve_attachment_points(
        &from, &to, &Direction::LeftRight, None, None,
    );
    assert_eq!(src.1, tgt.1, "LR attachment points should have consensus y even with different heights");
}

#[test]
fn test_rl_attachment_consensus_y() {
    let from = NodeBounds { x: 20, y: 2, width: 10, height: 3, dagre_center_x: None, dagre_center_y: Some(3) };
    let to = NodeBounds { x: 0, y: 4, width: 10, height: 3, dagre_center_x: None, dagre_center_y: Some(5) };
    let (src, tgt) = resolve_attachment_points(
        &from, &to, &Direction::RightLeft, None, None,
    );
    assert_eq!(src.1, tgt.1, "RL attachment points should have consensus y");
}
```

**What the failing test asserts:** Both source and target attachment points share the same y-coordinate for LR/RL edges.
**Expected failure reason:** Current implementation uses independent `center_y()` per node, producing different y values.

### ðŸŸ¢ Green: Minimal Implementation

*(Covered in Task 1.2)*

### ðŸ”µ Refactor: Clean Up

*(Covered in Task 1.2)*

## Context
- `resolve_attachment_points()` is at `src/render/router.rs` lines ~300-347
- The function takes `NodeBounds` refs, `Direction`, and optional override points
- For LR: source attaches to right face, target to left face
- `NodeBounds` may not have `dagre_center_y` fields yet â€” Task 2.1 adds them. These tests should work with `None` values initially (falling back to integer division center).

## Acceptance Criteria
- [ ] Failing tests written and confirmed red
- [ ] Tests compile and fail for the expected reason (different y values)
