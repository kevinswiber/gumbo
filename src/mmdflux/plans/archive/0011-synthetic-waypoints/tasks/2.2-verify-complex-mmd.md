# Task 2.2: Run complex.mmd and verify E→F routing improved

## Objective

Verify that the synthetic waypoint implementation fixes the original problem case: the E→F "no" edge in `complex.mmd`.

## Test Procedure

### 1. Run the current implementation (before changes)

```bash
cargo run -q -- ./tests/fixtures/complex.mmd > /tmp/complex-before.txt
```

Save this output for comparison.

### 2. Run with synthetic waypoints (after changes)

```bash
cargo run -q -- ./tests/fixtures/complex.mmd > /tmp/complex-after.txt
```

### 3. Compare outputs

```bash
diff /tmp/complex-before.txt /tmp/complex-after.txt
```

### 4. Visual inspection

Look for the E→F edge (from "More Data?" to "Output" with label "no"):

**Before (problematic):**
```
                              ┌────────────┐
                              < More Data? >  ← E
                              └────────────┘
            ┌────────────────────┘
            │                              ← horizontal through middle
            │
            ▼
        ┌────────┐
        │ Output │  ← F
        └────────┘
```

**After (expected):**
```
                              ┌────────────┐
                              < More Data? >  ← E
                              └────────────┘
                                         │
                                         │  ← stays on right
                                         │
                                         └───┐
                                             │
                                    ┌────────┘
                                    ▼
                                ┌────────┐
                                │ Output │  ← F
                                └────────┘
```

## Key Verification Points

1. **E node position**: Should still be on the right side of the diagram
2. **F node position**: Should still be centered/left
3. **E→F edge path**:
   - First vertical segment should stay at E's X position (right side)
   - Horizontal segment should be near the bottom, not in the middle
   - Final vertical segment should descend to F

4. **Other edges unchanged**:
   - The "yes" edge from "More Data?" back to "Input" (backward edge)
   - All edges from "Error Handler" downward
   - Simple forward edges (A→B, B→C, etc.)

## Automated Verification

Add assertions to the integration test:

```rust
#[test]
fn test_complex_e_to_f_routing_improved() {
    let input = include_str!("fixtures/complex.mmd");
    let output = render_to_string(input, &default_options());

    // The output should contain the "no" label
    assert!(output.contains("no"));

    // Find the vertical segment from "More Data?" - it should be on the right side
    // This is a heuristic check based on character positions

    // Look for the pattern: a vertical line character (│) that's far right
    // followed by lines with the "no" label

    // Alternative: Use snapshot testing
    insta::assert_snapshot!("complex_mmd_output", output);
}
```

## Regression Checks

Ensure these aspects of `complex.mmd` are NOT affected:

1. **Node positions** - All nodes should be in same relative positions
2. **Backward edge** ("yes" from "More Data?" to "Input") - Should use corridor
3. **Forward edges in left/center** - Should use default mid-y routing
4. **Labels** - All edge labels should render correctly

## Acceptance Criteria

- [ ] E→F "no" edge routes via right side, not through middle
- [ ] Visual inspection confirms cleaner routing
- [ ] All other edges in complex.mmd render correctly
- [ ] No regression in node positioning
- [ ] Backward edge still uses corridor
- [ ] Integration test updated with new expected output
