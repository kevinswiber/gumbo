# Task 1.1: Add EdgeAnalysis struct and analyze_edge() function

## Objective

Create the analysis infrastructure to determine which edges need synthetic waypoints.

## Location

`src/render/router.rs` - add near the top of the file, after existing structs

## Implementation

### EdgeAnalysis Struct

```rust
/// Analysis of an edge to determine if it needs synthetic waypoints
#[derive(Debug)]
struct EdgeAnalysis {
    /// Horizontal distance between source and target centers
    horizontal_offset: usize,
    /// Position of source node relative to diagram center
    source_position: SourcePosition,
    /// Whether this edge needs synthetic waypoints
    needs_synthetic_waypoints: bool,
}

#[derive(Debug, Clone, Copy, PartialEq)]
enum SourcePosition {
    Left,
    Center,
    Right,
}
```

### analyze_edge() Function

```rust
/// Threshold for considering an edge to have "large" horizontal offset
const LARGE_OFFSET_THRESHOLD: usize = 20;

/// Analyze an edge to determine if it needs synthetic waypoints
fn analyze_edge(
    from_bounds: &NodeBounds,
    to_bounds: &NodeBounds,
    layout: &Layout,
    direction: Direction,
) -> EdgeAnalysis {
    // Only handle vertical layouts initially
    if !matches!(direction, Direction::TopDown | Direction::BottomTop) {
        return EdgeAnalysis {
            horizontal_offset: 0,
            source_position: SourcePosition::Center,
            needs_synthetic_waypoints: false,
        };
    }

    let horizontal_offset = from_bounds.center_x().abs_diff(to_bounds.center_x());
    let diagram_center_x = layout.width / 2;

    // Determine source position (with some tolerance around center)
    let tolerance = layout.width / 6; // ~16% of width on each side of center
    let source_position = if from_bounds.center_x() < diagram_center_x.saturating_sub(tolerance) {
        SourcePosition::Left
    } else if from_bounds.center_x() > diagram_center_x + tolerance {
        SourcePosition::Right
    } else {
        SourcePosition::Center
    };

    // Determine if synthetic waypoints are needed
    let needs_synthetic = horizontal_offset > LARGE_OFFSET_THRESHOLD
        && source_position != SourcePosition::Center
        && match direction {
            Direction::TopDown => to_bounds.center_y() > from_bounds.center_y(),
            Direction::BottomTop => to_bounds.center_y() < from_bounds.center_y(),
            _ => false,
        };

    EdgeAnalysis {
        horizontal_offset,
        source_position,
        needs_synthetic_waypoints: needs_synthetic,
    }
}
```

## Tests to Add

```rust
#[cfg(test)]
mod analyze_edge_tests {
    use super::*;

    fn make_bounds(x: usize, y: usize, w: usize, h: usize) -> NodeBounds {
        NodeBounds { x, y, width: w, height: h }
    }

    fn make_layout(width: usize) -> Layout {
        Layout {
            width,
            height: 100,
            // ... other fields with defaults
        }
    }

    #[test]
    fn test_analyze_edge_large_offset_right_source() {
        let layout = make_layout(100);
        let from = make_bounds(80, 10, 10, 5); // Right side
        let to = make_bounds(30, 50, 10, 5);   // Center-left

        let analysis = analyze_edge(&from, &to, &layout, Direction::TopDown);

        assert_eq!(analysis.source_position, SourcePosition::Right);
        assert!(analysis.horizontal_offset > LARGE_OFFSET_THRESHOLD);
        assert!(analysis.needs_synthetic_waypoints);
    }

    #[test]
    fn test_analyze_edge_small_offset() {
        let layout = make_layout(100);
        let from = make_bounds(45, 10, 10, 5);
        let to = make_bounds(50, 50, 10, 5);

        let analysis = analyze_edge(&from, &to, &layout, Direction::TopDown);

        assert!(!analysis.needs_synthetic_waypoints);
    }

    #[test]
    fn test_analyze_edge_center_source() {
        let layout = make_layout(100);
        let from = make_bounds(45, 10, 10, 5); // Center
        let to = make_bounds(80, 50, 10, 5);   // Right

        let analysis = analyze_edge(&from, &to, &layout, Direction::TopDown);

        assert_eq!(analysis.source_position, SourcePosition::Center);
        assert!(!analysis.needs_synthetic_waypoints);
    }
}
```

## Acceptance Criteria

- [ ] `EdgeAnalysis` struct defined with all fields
- [ ] `SourcePosition` enum defined
- [ ] `LARGE_OFFSET_THRESHOLD` constant defined (start with 20)
- [ ] `analyze_edge()` correctly identifies right-side sources
- [ ] `analyze_edge()` correctly identifies left-side sources
- [ ] `analyze_edge()` returns `needs_synthetic_waypoints: false` for center sources
- [ ] `analyze_edge()` returns `needs_synthetic_waypoints: false` for small offsets
- [ ] Unit tests pass
