# Task 2.2: Handle Canvas Sizing for Stagger

## Objective

Ensure the canvas (width for TD/BT, height for LR/RL) is large enough to accommodate stagger offsets without clipping nodes or edges.

## Location

Modify: `src/render/layout.rs` â€” canvas size calculation in `grid_to_draw_vertical()` and `grid_to_draw_horizontal()`.

## Implementation

### Current approach

Canvas width for TD/BT (line ~659):
```rust
let canvas_width = max_layer_content_width
    + 2 * config.padding
    + config.left_label_margin
    + config.right_label_margin;
```

This is computed BEFORE nodes are positioned. With stagger, nodes may extend beyond this width.

### Fix: Recalculate after positioning

After the node positioning loop, recalculate canvas dimensions from actual node bounds:

```rust
// After all nodes positioned:
let actual_extent = node_bounds.values()
    .map(|b| b.x + b.width)  // for vertical: rightmost node edge
    .max()
    .unwrap_or(0);

let canvas_width = actual_extent
    .max(max_layer_content_width + config.padding + config.left_label_margin)
    + config.padding
    + config.right_label_margin;
```

Same pattern for horizontal layouts with Y axis.

### Edge corridor space

Backward edges route through corridors to the right of (TD) or below (LR) the diagram content. The canvas needs extra space for these corridors. Currently this is handled by `right_label_margin` / padding. With stagger, the rightmost node is already offset, so corridor space may need adjustment.

Verify that the existing corridor allocation (handled in router.rs) still works correctly when the diagram content is wider due to stagger.

## Context

- Canvas sizing affects edge routing corridors and label placement.
- The `right_label_margin` config value reserves space for edge labels on the right side.
- Stagger typically adds 2-8 chars of extra width.

## Acceptance Criteria

- [ ] Canvas width/height accounts for actual node positions after stagger
- [ ] No nodes are clipped or placed outside canvas bounds
- [ ] Edge routing corridors still have sufficient space
- [ ] Label margins still work correctly
