# Task 3.2: Visual Regression Testing

## Objective

Run all existing test fixtures and verify no visual regressions for non-staggered diagrams, while confirming improved output for stagger cases.

## Location

Run: `cargo test` (all tests), plus manual rendering of key fixtures.

## Implementation

### Step 1: Run existing test suite

```bash
cargo test
```

All existing tests must pass. Any snapshot tests that compare rendered output will need updating for stagger cases (but should be unchanged for non-stagger cases).

### Step 2: Render and verify key fixtures

```bash
# Should show stagger:
cargo run -- tests/fixtures/multiple_cycles.mmd
cargo run -- tests/fixtures/complex.mmd
cargo run -- tests/fixtures/simple_cycle.mmd

# Should NOT show stagger (unchanged from current output):
cargo run -- tests/fixtures/simple.mmd
cargo run -- tests/fixtures/chain.mmd
cargo run -- tests/fixtures/fan_in.mmd
cargo run -- tests/fixtures/fan_out.mmd

# Directional tests:
cargo run -- tests/fixtures/left_right.mmd
cargo run -- tests/fixtures/right_left.mmd
cargo run -- tests/fixtures/bottom_top.mmd
```

### Step 3: Verify attachment point separation

For `multiple_cycles.mmd`, the rendered output should show forward and backward edges attaching at visually distinct positions on shared nodes. The backward edge corridor should not overlap with the forward edge path.

### Step 4: Update snapshot tests

If integration tests use snapshot comparison (`.expected` files), update the expected output for stagger cases. Non-stagger fixtures should produce identical output.

## Context

- The risk assessment from the research identified that stagger changes ALL diagrams with backward edges. Visual inspection is critical.
- Simple diagrams (no backward edges) should produce byte-identical output to current behavior.
- The `--debug` flag can be useful for inspecting coordinate values.

## Acceptance Criteria

- [ ] `cargo test` passes (all existing tests)
- [ ] Non-stagger fixtures produce identical output to current behavior
- [ ] Stagger fixtures show visually offset nodes matching Mermaid's behavior
- [ ] Forward and backward edges on shared nodes attach at different positions
- [ ] All four directions (TD, BT, LR, RL) render correctly
- [ ] Snapshot tests updated where needed
