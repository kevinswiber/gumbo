# Task 4.2: Add SubgraphBounds to Render Layout Struct

## Objective

Pass subgraph bounding box information from dagre `LayoutResult` through to the render `Layout` struct, computing draw coordinates with padding for borders.

## Location

Modify: `src/render/layout.rs`

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_layout_subgraph_bounds_present() {
    let input = "graph TD\nsubgraph sg1[Group]\nA --> B\nend\n";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let layout = compute_layout_direct(&diagram, &default_config());

    assert!(layout.subgraph_bounds.contains_key("sg1"));
    let bounds = &layout.subgraph_bounds["sg1"];
    assert!(bounds.width > 0);
    assert!(bounds.height > 0);
    assert_eq!(bounds.title, "Group");
}

#[test]
fn test_layout_no_subgraph_bounds_simple() {
    let input = "graph TD\nA --> B\n";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let layout = compute_layout_direct(&diagram, &default_config());

    assert!(layout.subgraph_bounds.is_empty());
}

#[test]
fn test_layout_canvas_dimensions_include_borders() {
    let input = "graph TD\nsubgraph sg1[Group]\nA --> B\nend\n";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let layout = compute_layout_direct(&diagram, &default_config());

    // Canvas should be large enough to contain subgraph borders + padding
    let bounds = &layout.subgraph_bounds["sg1"];
    assert!(layout.width >= bounds.x + bounds.width);
    assert!(layout.height >= bounds.y + bounds.height);
}
```

**What the failing test asserts:** Render Layout includes subgraph bounds with draw coordinates and title.
**Expected failure reason:** Layout struct has no `subgraph_bounds` field.

### Green: Minimal Implementation

Add to render `Layout`:
```rust
pub struct SubgraphBounds {
    pub x: usize,
    pub y: usize,
    pub width: usize,
    pub height: usize,
    pub title: String,
}

pub struct Layout {
    // ... existing fields ...
    pub subgraph_bounds: HashMap<String, SubgraphBounds>,
}
```

In `compute_layout_direct`, after computing node draw positions:
```rust
// Convert dagre subgraph bounds to draw coordinates
let mut subgraph_bounds = HashMap::new();
for (sg_id, rect) in &dagre_result.subgraph_bounds {
    if let Some(sg) = diagram.subgraphs.get(sg_id) {
        let draw_x = /* convert from dagre coords to draw coords with padding */;
        let draw_y = /* convert with padding */;
        subgraph_bounds.insert(sg_id.clone(), SubgraphBounds {
            x: draw_x,
            y: draw_y,
            width: /* with padding */,
            height: /* with padding */,
            title: sg.title.clone(),
        });
    }
}
```

### Refactor: Clean Up

- Ensure padding values are consistent (1-2 cells around member nodes)
- Add title height to the bounding box calculation (title is above the border)
- Verify canvas expansion accounts for border padding

## Context

- dagre `LayoutResult` provides `subgraph_bounds` as `HashMap<String, Rect>` (center-based coordinates)
- Render `Layout` needs draw coordinates (top-left based, integer cells)
- Padding is needed around member nodes for the border rectangle
- Title placement above the border requires additional vertical space

## Acceptance Criteria

- [ ] Failing tests written and confirmed red
- [ ] `SubgraphBounds` struct with x, y, width, height, title
- [ ] Layout struct has `subgraph_bounds` field
- [ ] Draw coordinates computed with padding from dagre bounds
- [ ] Canvas dimensions account for borders
- [ ] Simple diagrams have empty subgraph_bounds
