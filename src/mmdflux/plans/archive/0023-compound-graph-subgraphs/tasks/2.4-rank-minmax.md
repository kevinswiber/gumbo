# Task 2.4: Implement assign_rank_minmax

## Objective

After ranking and nesting cleanup, compute `min_rank` and `max_rank` for each compound node from its border_top and border_bottom node ranks.

## Location

New function in `src/dagre/nesting.rs` (or `src/dagre/mod.rs`)

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_assign_rank_minmax() {
    let mut lg = build_test_compound_layout_graph();
    nesting::run(&mut lg);
    rank::run(&mut lg);
    rank::normalize(&mut lg);
    nesting::cleanup(&mut lg);

    assign_rank_minmax(&mut lg);

    let sg1_idx = /* compound node index */;
    assert!(lg.min_rank.contains_key(&sg1_idx));
    assert!(lg.max_rank.contains_key(&sg1_idx));
    assert!(lg.min_rank[&sg1_idx] <= lg.max_rank[&sg1_idx]);
}

#[test]
fn test_assign_rank_minmax_noop_simple() {
    let mut lg = build_test_simple_layout_graph();
    rank::run(&mut lg);
    rank::normalize(&mut lg);

    assign_rank_minmax(&mut lg);

    assert!(lg.min_rank.is_empty());
    assert!(lg.max_rank.is_empty());
}
```

**What the failing test asserts:** min_rank/max_rank correctly set from border node ranks.
**Expected failure reason:** `assign_rank_minmax` function does not exist.

### Green: Minimal Implementation

```rust
pub fn assign_rank_minmax(lg: &mut LayoutGraph) {
    for &compound_idx in &lg.compound_nodes {
        if let Some(&top_idx) = lg.border_top.get(&compound_idx) {
            lg.min_rank.insert(compound_idx, lg.ranks[top_idx]);
        }
        if let Some(&bot_idx) = lg.border_bottom.get(&compound_idx) {
            lg.max_rank.insert(compound_idx, lg.ranks[bot_idx]);
        }
    }
}
```

### Refactor: Clean Up

- Consider whether this should live in `nesting.rs` or as a standalone function in `mod.rs`
- Add assertion that min_rank <= max_rank in debug builds

## Context

- Border top/bottom nodes get ranks during `rank::run()` because they have nesting edges connecting them to children
- After cleanup, nesting edges are removed but the border nodes retain their ranks
- min_rank/max_rank define the vertical span for border segment creation (Task 2.5)

## Acceptance Criteria

- [ ] Failing tests written and confirmed red
- [ ] `assign_rank_minmax` correctly computes rank ranges
- [ ] No-op for simple graphs
- [ ] Tests pass
