# Task 1.4: Add Subgraph Struct and Parent Field to Graph Layer

## Objective

Add `parent: Option<String>` to `Node`, create a `Subgraph` struct, and add `subgraphs: HashMap<String, Subgraph>` to `Diagram`.

## Location

Modify: `src/graph/node.rs`, `src/graph/diagram.rs`

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_node_parent_default_none() {
    let node = Node::new("A", "A", Shape::Rectangle);
    assert_eq!(node.parent, None);
}

#[test]
fn test_node_parent_set() {
    let mut node = Node::new("A", "A", Shape::Rectangle);
    node.parent = Some("sg1".to_string());
    assert_eq!(node.parent, Some("sg1".to_string()));
}

#[test]
fn test_subgraph_construction() {
    let sg = Subgraph {
        id: "sg1".to_string(),
        title: "My Group".to_string(),
        nodes: vec!["A".to_string(), "B".to_string()],
    };
    assert_eq!(sg.id, "sg1");
    assert_eq!(sg.title, "My Group");
    assert_eq!(sg.nodes.len(), 2);
}

#[test]
fn test_diagram_subgraphs_empty() {
    let diagram = Diagram::new(Direction::TopDown);
    assert!(diagram.subgraphs.is_empty());
    assert!(!diagram.has_subgraphs());
}

#[test]
fn test_diagram_has_subgraphs() {
    let mut diagram = Diagram::new(Direction::TopDown);
    diagram.subgraphs.insert("sg1".to_string(), Subgraph {
        id: "sg1".to_string(),
        title: "Group".to_string(),
        nodes: vec![],
    });
    assert!(diagram.has_subgraphs());
}
```

**What the failing test asserts:** Node has `parent` field; `Subgraph` struct exists; Diagram has `subgraphs` field and `has_subgraphs()`.
**Expected failure reason:** `parent` field does not exist on Node; `Subgraph` type does not exist; `subgraphs` field and method not on Diagram.

### Green: Minimal Implementation

In `src/graph/node.rs`, add to `Node`:
```rust
pub parent: Option<String>,
```
Update `Node::new()` to set `parent: None`.

In `src/graph/diagram.rs`, add:
```rust
#[derive(Debug, Clone, PartialEq, Eq)]
pub struct Subgraph {
    pub id: String,
    pub title: String,
    pub nodes: Vec<String>,
}
```

Add to `Diagram`:
```rust
pub subgraphs: HashMap<String, Subgraph>,
```

Add method:
```rust
impl Diagram {
    pub fn has_subgraphs(&self) -> bool {
        !self.subgraphs.is_empty()
    }
}
```

Update `Diagram::new()` to initialize `subgraphs: HashMap::new()`.

### Refactor: Clean Up

- Ensure `Subgraph` is exported from the `graph` module
- Verify all existing `Node::new()` and `Diagram::new()` call sites compile

## Context

- Current `Node` has: `id`, `label`, `shape` -- no parent field
- Current `Diagram` has: `direction`, `nodes`, `edges` -- no subgraphs
- Reference: [Q4 research](../../../research/0016-compound-graph-subgraphs/q4-graph-layer-design.md)

## Acceptance Criteria

- [ ] Failing tests written and confirmed red
- [ ] `parent: Option<String>` added to Node
- [ ] `Subgraph` struct created with `id`, `title`, `nodes`
- [ ] `subgraphs` field added to Diagram
- [ ] `has_subgraphs()` method works
- [ ] All existing tests pass
