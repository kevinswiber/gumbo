# Task 1.6: Add Test Fixtures for Subgraphs

## Objective

Create fixture `.mmd` files and integration tests verifying subgraph parsing and building.

## Location

New files: `tests/fixtures/simple_subgraph.mmd`, `tests/fixtures/subgraph_edges.mmd`, `tests/fixtures/multi_subgraph.mmd`
Modify: `tests/integration.rs`

## TDD Phases

### Red: Write Failing Tests

```rust
#[test]
fn test_parse_simple_subgraph_fixture() {
    let input = std::fs::read_to_string("tests/fixtures/simple_subgraph.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);

    assert!(diagram.has_subgraphs());
    assert!(diagram.subgraphs.contains_key("sg1"));
    assert_eq!(diagram.subgraphs["sg1"].title, "Process");
}

#[test]
fn test_parse_subgraph_edges_fixture() {
    let input = std::fs::read_to_string("tests/fixtures/subgraph_edges.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);

    assert_eq!(diagram.subgraphs.len(), 2);
    // Edges cross subgraph boundaries
    assert!(diagram.edges.iter().any(|e| e.from == "A" && e.to == "C"));
}

#[test]
fn test_parse_multi_subgraph_fixture() {
    let input = std::fs::read_to_string("tests/fixtures/multi_subgraph.mmd").unwrap();
    let flowchart = parse_flowchart(&input).unwrap();
    let diagram = build_diagram(&flowchart);

    assert_eq!(diagram.subgraphs.len(), 2);
    assert!(diagram.subgraphs.contains_key("sg1"));
    assert!(diagram.subgraphs.contains_key("sg2"));
}
```

**What the failing test asserts:** Fixture files exist and parse/build correctly.
**Expected failure reason:** Fixture files don't exist yet.

### Green: Minimal Implementation

Create fixture files:

`tests/fixtures/simple_subgraph.mmd`:
```
graph TD
    subgraph sg1[Process]
    A[Start] --> B[Middle]
    end
    B --> C[End]
```

`tests/fixtures/subgraph_edges.mmd`:
```
graph TD
    subgraph sg1[Input]
    A[Data]
    B[Config]
    end
    subgraph sg2[Output]
    C[Result]
    D[Log]
    end
    A --> C
    B --> D
```

`tests/fixtures/multi_subgraph.mmd`:
```
graph LR
    subgraph sg1[Frontend]
    A[UI] --> B[API]
    end
    subgraph sg2[Backend]
    C[Server] --> D[DB]
    end
    B --> C
```

### Refactor: Clean Up

- Ensure fixture formatting is consistent with existing fixtures
- Consider adding comments to fixtures explaining what they test

## Context

- Existing fixtures in `tests/fixtures/` cover various diagram patterns
- Integration tests in `tests/integration.rs` verify the full pipeline
- These fixtures will also be used in Phase E for full render testing

## Acceptance Criteria

- [ ] Three fixture files created
- [ ] Integration tests verify correct parsing and building
- [ ] Tests pass with correct subgraph counts, titles, and node membership
