# Task 3.1: Remove Corridor Fields and Canvas Expansion

## Objective

Remove all corridor-related fields from the `Layout` struct, the canvas expansion logic, the lane assignment function, and corridor computation from both layout paths.

## Location

Modify: `src/render/layout.rs`

## Implementation

### Change 1: Remove corridor fields from `Layout` struct (lines 39-44)

```rust
// REMOVE these three fields:
pub backward_corridors: usize,
pub corridor_width: usize,
pub backward_edge_lanes: HashMap<(String, String), usize>,
```

The struct becomes:

```rust
pub struct Layout {
    pub grid_positions: HashMap<String, GridPos>,
    pub draw_positions: HashMap<String, (usize, usize)>,
    pub node_bounds: HashMap<String, NodeBounds>,
    pub width: usize,
    pub height: usize,
    pub h_spacing: usize,
    pub v_spacing: usize,
    // Edge routing data from normalization
    pub edge_waypoints: HashMap<(String, String), Vec<(usize, usize)>>,
    pub edge_label_positions: HashMap<(String, String), (usize, usize)>,
    pub node_shapes: HashMap<String, Shape>,
}
```

### Change 2: Remove from `compute_layout()` (non-dagre path)

In `compute_layout()` (starts at line 97):

- Remove `assign_backward_edge_lanes()` call (~line 115-117):
  ```rust
  // DELETE:
  let (backward_corridors, backward_edge_lanes) =
      assign_backward_edge_lanes(diagram, &grid_positions);
  let corridor_width = 3;
  ```

- Remove corridor canvas expansion (~lines 156-168):
  ```rust
  // DELETE:
  if backward_corridors > 0 {
      let corridor_space = backward_corridors * corridor_width;
      match diagram.direction {
          Direction::TopDown | Direction::BottomTop => width += corridor_space,
          Direction::LeftRight | Direction::RightLeft => height += corridor_space,
      }
  }
  ```

- Remove corridor fields from the Layout constructor at the end of `compute_layout()`:
  ```rust
  // DELETE these lines from the Layout { ... } block:
  backward_corridors,
  corridor_width,
  backward_edge_lanes,
  ```

### Change 3: Remove from `compute_layout_dagre()`

- Remove backward edge lane computation (lines 348-361):
  ```rust
  // DELETE:
  let backward_edge_lanes: HashMap<(String, String), usize> = result
      .reversed_edges
      .iter()
      .enumerate()
      .filter_map(|(lane, &edge_idx)| {
          diagram
              .edges
              .get(edge_idx)
              .map(|edge| ((edge.from.clone(), edge.to.clone()), lane))
      })
      .collect();

  let backward_corridors = backward_edge_lanes.len();
  let corridor_width = 3;
  ```

- Remove canvas expansion (lines 403-410):
  ```rust
  // DELETE:
  if backward_corridors > 0 {
      let corridor_space = backward_corridors * corridor_width;
      match diagram.direction {
          Direction::TopDown | Direction::BottomTop => width += corridor_space,
          Direction::LeftRight | Direction::RightLeft => height += corridor_space,
      }
  }
  ```

- Remove corridor fields from the Layout constructor at the end of `compute_layout_dagre()`:
  ```rust
  // DELETE these lines from the Layout { ... } block:
  backward_corridors,
  corridor_width,
  backward_edge_lanes,
  ```

### Change 4: Delete `assign_backward_edge_lanes()` function entirely (lines 508-555)

```rust
// DELETE the entire function:
fn assign_backward_edge_lanes(
    diagram: &Diagram,
    grid_positions: &HashMap<String, GridPos>,
) -> (usize, HashMap<(String, String), usize>) { ... }
```

## Context

- After Tasks 2.1 and 2.2, nothing references `backward_corridors`, `corridor_width`, or `backward_edge_lanes` in router.rs.
- The `compute_layout()` (non-dagre) path also uses these fields — both paths must be cleaned up.
- Canvas `width`/`height` will shrink because corridor space is no longer added. This is the desired behavior — backward edges now route within the layout area.

## Acceptance Criteria

- [ ] `Layout` struct has no corridor-related fields
- [ ] `assign_backward_edge_lanes()` is deleted
- [ ] Canvas dimensions no longer include corridor space
- [ ] `cargo build` compiles without errors
- [ ] No references to `backward_corridors`, `corridor_width`, or `backward_edge_lanes` remain
