# Task 6.2: Add Integration Tests

## Objective
Add integration tests that verify correct rendering of nested subgraph fixtures through the full pipeline.

## Location
Modify: `tests/integration.rs`

## TDD Phases

### ğŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_nested_subgraph_renders_both_borders() {
    let input = std::fs::read_to_string("tests/fixtures/nested_subgraph.mmd").unwrap();
    let output = render_mmd(&input);
    assert!(output.contains("Outer"), "Should contain outer border title");
    assert!(output.contains("Inner"), "Should contain inner border title");
}

#[test]
fn test_nested_subgraph_only_renders() {
    let input = std::fs::read_to_string("tests/fixtures/nested_subgraph_only.mmd").unwrap();
    let output = render_mmd(&input);
    assert!(output.contains("Outer"), "Should contain outer border title");
    assert!(output.contains("Inner"), "Should contain inner border title");
}

#[test]
fn test_nested_with_siblings_renders() {
    let input = std::fs::read_to_string("tests/fixtures/nested_with_siblings.mmd").unwrap();
    let output = render_mmd(&input);
    assert!(output.contains("Outer"), "Should contain outer border title");
    assert!(output.contains("Left"), "Should contain left border title");
    assert!(output.contains("Right"), "Should contain right border title");
}

#[test]
fn test_existing_subgraph_fixtures_unchanged() {
    // Render existing subgraph fixtures and compare to expected output
    // This is a regression guard
    for fixture in &["subgraph.mmd", "subgraph_edges.mmd", /* other existing fixtures */] {
        let input = std::fs::read_to_string(format!("tests/fixtures/{}", fixture)).unwrap();
        let output = render_mmd(&input);
        // Verify output is non-empty and does not panic
        assert!(!output.is_empty(), "{} should produce output", fixture);
    }
}
```

**What the failing tests assert:** Nested subgraph fixtures parse, build, layout, and render correctly with visible borders.
**Expected failure reason:** Should pass after all previous phases are complete.

### ğŸŸ¢ Green: Minimal Implementation

Should pass after Phases 1-5 are complete. If any fail, debug the specific pipeline stage.

### ğŸ”µ Refactor: Clean Up

Consider snapshot testing if the project supports it â€” store expected output and compare.

## Context
Follow existing patterns in `tests/integration.rs`. Check how existing subgraph tests are structured.

## Acceptance Criteria
- [ ] All nested fixtures parse, build, layout, and render without panics
- [ ] Both outer and inner borders are visible in output
- [ ] Sibling subgraphs within a nested container render correctly
- [ ] All existing integration tests continue to pass (regression guard)
