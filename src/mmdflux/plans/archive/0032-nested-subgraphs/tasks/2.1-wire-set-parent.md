# Task 2.1: Wire `set_parent` for Nested Subgraphs

## Objective
In `compute_layout_direct()`, after setting up parent relationships for nodes, also set up parent relationships for nested subgraphs so dagre's nesting algorithm creates proper compound hierarchies.

## Location
Modify: `src/render/layout.rs` (lines 145-158, the section that builds the dagre graph)

## TDD Phases

### ğŸ”´ Red: Write Failing Tests

```rust
#[test]
fn test_nested_subgraph_layout_produces_both_bounds() {
    let input = "graph TD\nsubgraph outer[Outer]\nA[Node A]\nsubgraph inner[Inner]\nB[Node B]\nend\nend\nA --> B\n";
    let flowchart = parse_flowchart(input).unwrap();
    let diagram = build_diagram(&flowchart);
    let config = RenderConfig::default();
    let layout = compute_layout(&diagram, &config);
    assert!(layout.subgraph_bounds.contains_key("outer"));
    assert!(layout.subgraph_bounds.contains_key("inner"));
}
```

**What the failing test asserts:** Both inner and outer subgraphs get layout bounds.
**Expected failure reason:** Without `set_parent` for subgraph-to-subgraph relationships, dagre doesn't create proper compound nesting, and bounds computation may fail for the outer subgraph.

### ğŸŸ¢ Green: Minimal Implementation

After the existing node parent-setting loop in `compute_layout_direct()` (around line 153-158), add:

```rust
// Set parent relationships for nested subgraphs
for (sg_id, sg) in &diagram.subgraphs {
    if let Some(ref parent_id) = sg.parent {
        dgraph.set_parent(sg_id.as_str(), parent_id.as_str());
    }
}
```

### ğŸ”µ Refactor: Clean Up

Consider combining with the node parent loop if it reads better, or keep separate for clarity.

## Context
The dagre `DiGraph` already has `set_parent` infrastructure. Currently only nodes get `set_parent(node_id, subgraph_id)` calls. This task adds `set_parent(child_sg_id, parent_sg_id)` calls for nested subgraphs.

See [Q2: Dagre compound nesting](../../../research/0025-nested-subgraphs/q2-dagre-compound-nesting.md) â€” research confirms dagre's nesting algorithm handles multi-level nesting once parents are set.

## Acceptance Criteria
- [ ] Failing test written and confirmed red
- [ ] Nested subgraphs have their parent set in the dagre `DiGraph`
- [ ] Layout completes without panics for nested subgraph input
- [ ] Both inner and outer subgraphs appear in layout bounds
- [ ] Code refactored with tests still green
